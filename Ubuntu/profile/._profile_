#!/bin/bash

export LANG="C"
export LC_CTYPE="zh_CN.UTF-8"
export LC_COLLATE="zh_CN.UTF-8"

# disable homebrew auto update
export HOMEBREW_NO_AUTO_UPDATE=1

# configure environment for nodenv
command -v nodenv &>/dev/null && {
  eval "$(nodenv init -)"
}


# specify workspace path
PROJECTS_DIR=
PROJECTS_DIRS=(
  "${HOME}/Projects"
  "/mnt/d/Projects"
  "/mnt/e/Projects"
)

for target in ${PROJECTS_DIRS[@]}; do
  PROJECTS_DIR=$target

  if [[ ! -d "$PROJECTS_DIR" ]]; then
    unset PROJECTS_DIR
  else
    break
  fi
done

if [[ ! -d "$PROJECTS_DIR" ]]; then
  WINHOME=$(wslpath "$(wslvar USERPROFILE)")
  PROJECTS_DIR=${WINHOME}/Downloads/Projects
fi


if [[ ! -d "$PROJECTS_DIR" ]]; then
  unset PROJECTS_DIR
else
  # load custom scripts
  PRIVACY_DIR="$PROJECTS_DIR"

  if [[ -d "$PROJECTS_DIR/Privacy" ]]; then
    PRIVACY_DIR="$PROJECTS_DIR/Privacy"
  fi

  if [[ -f "${PRIVACY_DIR}/alias/alias.sh" ]]; then
    source "${PRIVACY_DIR}/alias/alias.sh"

    # setup proxy server
    command -v proxy &>/dev/null && {
      proxy set --force
    }
  fi

  # enter workspace
  cd "$PROJECTS_DIR"
fi
